<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png" />
    <title>Ela - 云辰自動化測試系統</title>

    <link href="/templates/css/lib/chartist/chartist.min.css" rel="stylesheet" />
    <link href="/templates/css/lib/owl.carousel.min.css" rel="stylesheet" />
    <link href="/templates/css/lib/owl.theme.default.min.css" rel="stylesheet" />
    <!-- Bootstrap Core CSS -->
    <link href="/templates/css/lib/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="/templates/css/helper.css" rel="stylesheet" />
    <link href="/templates/css/style.css" rel="stylesheet" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:** -->
    <!--[if lt IE 9]>
      <script src="https:**oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https:**oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <style>
.dropdown-menu {
    display: none; /* Hide the dropdown menu initially */
}

.close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    cursor: pointer;
}

.spinner {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #3498db;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8); 
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000; 
    }
.disabled {
    pointer-events: none;
    opacity: 0.5;
}
  </style>
  <body class="fix-header fix-sidebar">
    <!-- Preloader - style you can find in spinners.css -->
    <div class="preloader">
      <svg class="circular" viewBox="25 25 50 50">
        <circle
          class="path"
          cx="50"
          cy="50"
          r="20"
          fill="none"
          stroke-width="2"
          stroke-miterlimit="10"
        />
      </svg>
    </div>
    <!-- Main wrapper  -->
    <div id="main-wrapper">
      <!-- header header  -->
      <div class="header">
        <nav class="navbar top-navbar navbar-expand-md navbar-light">
          <!-- Logo -->
          <div class="navbar-header">
            <a class="navbar-brand" href="/templates/index.html">
              <!-- Logo icon -->
              <b
                ><img src="/templates/images/logo.png" alt="homepage" class="dark-logo"
              /></b>
              <!--End Logo icon -->
              <!-- Logo text -->
              <span
                ><img
                  src="/templates/images/logo-text.png"
                  alt="homepage"
                  class="dark-logo"
              /></span>
            </a>
          </div>
          <!-- End Logo -->
          <div class="navbar-collapse">
            <!-- toggle and nav items -->
            <ul class="navbar-nav mr-auto mt-md-0">
              <!-- This is  -->
              <li class="nav-item">
                <a
                  class="nav-link nav-toggler hidden-md-up text-muted"
                  href="javascript:void(0)"
                  ><i class="mdi mdi-menu"></i
                ></a>
              </li>
              <li class="nav-item m-l-10">
                <a
                  class="nav-link sidebartoggler hidden-sm-down text-muted"
                  href="javascript:void(0)"
                  ><i class="ti-menu"></i
                ></a>
              </li>
            </ul>
            <!-- User profile and search -->
            <ul class="navbar-nav my-lg-0">
              <!-- Search -->
              <li class="nav-item hidden-sm-down search-box">
                <a
                  class="nav-link hidden-sm-down text-muted"
                  href="javascript:void(0)"
                  ><i class="ti-search"></i
                ></a>
                <form class="app-search">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search here"
                  />
                  <a class="srh-btn"><i class="ti-close"></i></a>
                </form>
              </li>
              <!-- Profile -->
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle text-muted"
                  ><img src="/templates/images/users/5.jpg" alt="user" class="profile-pic"
                /></a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <!-- End header header -->
      <!-- Left Sidebar  -->
      <div class="left-sidebar">
        <!-- Sidebar scroll-->
        <div class="scroll-sidebar">
          <!-- Sidebar navigation-->
          <nav class="sidebar-nav">
            <ul id="sidebarnav">
              <li class="nav-devider"></li>
              <li class="nav-label">Home</li>
              <li>
                <a class="has-arrow" href="#" aria-expanded="false"
                  ><i class="fa fa-tachometer"></i
                  ><span class="hide-menu">儀表板 </span></a
                >
                <ul aria-expanded="false" class="collapse">
                  <li><a href="/templates/index.html">所有裝置</a></li>
                </ul>
              </li>
              <li class="nav-label">Apps</li>
              <li>
                <a class="has-arrow" href="#" aria-expanded="false"
                  ><i class="fa fa-envelope"></i
                  ><span class="hide-menu">設備測試</span></a
                >
                <ul aria-expanded="false" class="collapse">
                  <li><a href="/templates/email-compose.html">設備控制</a></li>
                </ul>
              </li>
              <li>
                <a class="has-arrow" href="#" aria-expanded="false"
                  ><i class="fa fa-bar-chart"></i
                  ><span class="hide-menu">法規自動化</span></a
                >
                <ul aria-expanded="false" class="collapse">
                  <li><a href="/templates/chart-flot.html">IEC63180-2020</a></li>
                  <li><a href="/templates/chart-morris.html">NEMA WD7-2011</a></li>
                  <li><a href="/templates/chart-chartjs.html">EN50131-2-2-2017</a></li>
                  <li><a href="/templates/chart-chartist.html">EN50131-2-4-2020</a></li>
                </ul>
              </li>
            </ul>
          </nav>
          <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
      </div>
      <!-- End Left Sidebar  -->
      <!-- Page wrapper  -->
      <div class="page-wrapper">
        <!-- Bread crumb -->
        <div class="row page-titles">
          <div class="col-md-5 align-self-center">
            <h3 class="text-primary">儀表板/所有裝置</h3>
          </div>
          <div class="col-md-7 align-self-center">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="javascript:void(0)">APPS</a>
              </li>
              <li class="breadcrumb-item active">設備控制</li>
            </ol>
          </div>
        </div>


        <li class="nav-item dropdown mega-dropdown">
          <a
            class="nav-link dropdown-toggle text-muted"
            href="#"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            ><i class="fa fa-th-large">log</i></a
          >
          <div class="dropdown-menu animated zoomIn">
            <div class="dropdown-menu-header">

              <span id="closePopup" class="close">&times;</span>

            </div>
            <ul class="mega-dropdown-menu row">
              <li class="col-lg-3 m-b-30">
                <h4 class="m-b-20">操作日誌</h4>
                <!-- Contact -->
                <div id="log">
                  <p>時間 裝置 指令 狀態 操作者</p>
                </div>
                <div class="button-container">
                  <button onclick="downloadLog()">下載記錄</button>
                  <button onclick="clearLog()">清除</button>
              </div>
              </li>
            </ul>
          </div>
        </li>
        <div id="spinner-overlay" class="spinner-overlay" style="display: none;">
          <div class="spinner"></div>
      </div>
        <!-- End Bread crumb -->
        <h2>所有狀態</h2>
        <!-- Container fluid  -->
        <div class="container-fluid">
          <!-- Start Page Content -->
          <div class="row">
            <div class="col-md-3">
              <div class="card p-30">
                <h2>DUT手臂</h2>
                <div class="card-body">
                      <form onsubmit="dut_server(event)">
                      <div class="row">
                        <label for="servo_1" class="col-sm-3 control-label">Servo_1</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_1" name="servo_1" min="0" max="180" required><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="servo_2" class="col-sm-3 control-label">Servo_2</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_2" name="servo_2" min="0" max="180" required><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="servo_3" class="col-sm-3 control-label">Servo_3</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_3" name="servo_3" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="servo_4" class="col-sm-3 control-label">Servo_4</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_4" name="servo_4" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="servo_5" class="col-sm-3 control-label">Servo_5</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_5" name="servo_5" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="servo_6" class="col-sm-3 control-label">Servo_6</label>
                        <div class="col-sm-9">
                          <input type="number" id="servo_6" name="servo_6" min="0" max="180" required><br>
                        </div>
                      </div>
                      <button type="submit">送出</button>
                    </form>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card p-30">
                <h2>ARM手臂</h2>
                <div class="card-body">
                      <form onsubmit="arm_server(event)">
                      <div class="row">
                        <label for="arm_servo_1" class="col-sm-3 control-label">Servo_1</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_1" name="arm_servo_1" min="0" max="180" required><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="arm_servo_2" class="col-sm-3 control-label">Servo_2</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_2" name="arm_servo_2" min="0" max="180" required><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="arm_servo_3" class="col-sm-3 control-label">Servo_3</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_3" name="arm_servo_3" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="arm_servo_4" class="col-sm-3 control-label">Servo_4</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_4" name="arm_servo_4" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="arm_servo_5" class="col-sm-3 control-label">Servo_5</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_5" name="arm_servo_5" min="0" max="180" required><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="arm_servo_6" class="col-sm-3 control-label">Servo_6</label>
                        <div class="col-sm-9">
                          <input type="number" id="arm_servo_6" name="arm_servo_6" min="0" max="180" required><br>
                        </div>
                      </div>
                      <button type="submit">送出</button>
                    </form>
                </div>
              </div>
            </div>
              <div class="card p-30">
                <h2>STEP馬達</h2>
                <div class="input-states">
                    <form onsubmit="sendData(event)">
                    <div class="row">
                      <label for="real_position" class="col-sm-3 control-label"
                        >Postion from origin</label
                      >
                        <input type="text" id="real_position" name="real_position" min="0" max="6" required/>
                    </div>
                    <button type="submit">送出</button>
                  </form>
                </div>
              </div>
            <div class="col-md-3">
              <div class="card p-30">
                <h2>UNET DONGLE</h2>
                <div class="input-states">
                    <button onclick="sendButtonPress('on-btn')">AN203_ON</button>
                    <button onclick="sendButtonPress('off-btn')">AN203_OFF</button>
                </div>
              </div>
            </div>
          </div>
        
        <div class="container-fluid">
          <!-- Start Page Content -->
          <div class="row">
            <div class="col-md-3">
              <div class="card p-30">
                <h2>DUT手臂</h2>
                <div class="card-body">
                  <div class="input-states">
                    <form class="form-horizontal">
                      <div class="row">
                        <label for="received-servo_1" class="col-sm-3 control-label">Servo_1</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_1" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-servo_2" class="col-sm-3 control-label">Servo_2</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_2" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-servo_3" class="col-sm-3 control-label">Servo_3</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_3" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-servo_4" class="col-sm-3 control-label">Servo_4</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_4" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-servo_5" class="col-sm-3 control-label">Servo_5</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_5" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-servo_6" class="col-sm-3 control-label">Servo_6</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-servo_6" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-temperature" class="col-sm-3 control-label"
                          >Temperature</label
                        >
                        <div class="col-sm-9">
                          <input type="text" id="received-temperature" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-humidity" class="col-sm-3 control-label">Humidity</label>
                        <div class="col-sm-9">
                          <div class="input-group">
                            <input type="text" id="received-humidity" readonly><br>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-detect" class="col-sm-3 control-label">Detection</label>
                        <div class="col-sm-9">
                          <div class="input-group">
                            <input type="text" id="received-detect" readonly><br>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-set_servo" class="col-sm-3 control-label"
                          >Communication</label
                        >
                        <div class="col-sm-9">
                          <div class="input-group">
                            <input type="text" id="received-set_servo" readonly><br>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-ip_address" class="col-sm-3 control-label">IP address</label>
                        <div class="col-sm-9">
                          <div class="input-group">
                            <input type="text" id="received-ip_address" readonly><br>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-time" class="col-sm-3 control-label"
                          >Update time</label
                        >
                        <div class="col-sm-9">
                          <div class="input-group">
                            <input type="text" id="received-time" readonly><br>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card p-30">
                <h2>ARM手臂</h2>
                <div class="card-body">
                  <div class="input-states">
                    <form class="form-horizontal">
                      <div class="row">
                        <label for="received-arm_servo_1" class="col-sm-3 control-label">Servo_1</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_1" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_servo_2" class="col-sm-3 control-label">Servo_2</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_2" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_servo_3" class="col-sm-3 control-label">Servo_3</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_3" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-arm_servo_4" class="col-sm-3 control-label">Servo_4</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_4" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-arm_servo_5" class="col-sm-3 control-label">Servo_5</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_5" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-arm_servo_6" class="col-sm-3 control-label">Servo_6</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_servo_6" readonly><br>
                        </div>
                      </div>

                      <div class="row">
                        <label for="received-arm_temperature" class="col-sm-3 control-label"
                          >Temperature</label
                        >
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_temperature" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_humidity" class="col-sm-3 control-label">Humidity</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_humidity" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_detect" class="col-sm-3 control-label">Detection</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_detect" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_set_servo" class="col-sm-3 control-label"
                          >Communication</label
                        >
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_set_servo" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_ip_address" class="col-sm-3 control-label">IP address</label>
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_ip_address" readonly><br>
                        </div>
                      </div>
                      <div class="row">
                        <label for="received-arm_time" class="col-sm-3 control-label"
                          >Update time</label
                        >
                        <div class="col-sm-9">
                          <input type="text" id="received-arm_time" readonly><br>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card p-30">
                <h2>STEP馬達</h2>
                <div class="input-states">
                  <form class="form-horizontal">
                    <div class="row">
                      <label for="received-real_position" class="col-sm-3 control-label"
                        >Postion from origin</label
                      > 
                      <div class="col-sm-9">
                        <input type="number" id="received-real_position" readonly/>
                      </div>
                    </div>
                    <div class="row">
                      <label for="received-step_time" class="col-sm-3 control-label"
                        >更新時間</label
                      >
                      <div class="col-sm-9">
                        <input type="text" id="received-step_time" readonly><br>
                      </div>
                    </div>
                    <div class="row">
                      <label for="received-step_ip" class="col-sm-3 control-label"
                        >IP 位置:</label
                      >
                      <div class="col-sm-9">
                        <input type="text" id="received-step_ip" readonly><br>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card p-30">
                <h2>UNET DONGLE</h2>
                <div class="input-states">
                  <form class="form-horizontal">
                    <div class="row">
                      <label for="received-AN203_ON_OFF_test" class="col-sm-3 control-label">AN203</label>
                      <div class="col-sm-9">
                        <input type="text" id="received-AN203_ON_OFF_test" readonly>
                      </div>
                    </div>
                    <div class="row">
                      <label for="received-unet_ip" class="col-sm-3 control-label">IP address</label>
                      <div class="col-sm-9">
                        <input type="text" id="received-unet_ip" readonly><br>
                      </div>
                    </div>

                    <div class="row">
                      <label for="received-unet_time" class="col-sm-3 control-label">更新時間:</label>
                      <div class="col-sm-9">
                        <input type="text" id="received-unet_time" readonly><br>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- End PAge Content -->
        </div>
        <!-- End Container fluid  -->
        <!-- footer -->
        <!-- End footer -->
      </div>
      <!-- End Page wrapper  -->
    </div>
    <!-- End Wrapper -->
    <!-- All Jquery -->
    <script src="/templates/js/lib/jquery/jquery.min.js"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="/templates/js/lib/bootstrap/js/popper.min.js"></script>
    <script src="/templates/js/lib/bootstrap/js/bootstrap.min.js"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <script src="/templates/js/jquery.slimscroll.js"></script>
    <!--Menu sidebar -->
    <script src="/templates/js/sidebarmenu.js"></script>
    <!--stickey kit -->
    <script src="/templates/js/lib/sticky-kit-master/dist/sticky-kit.min.js"></script>
    <script>
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script src="/templates/js/lib/datamap/d3.min.js"></script>
    <script src="/templates/js/lib/datamap/topojson.js"></script>
    <script src="/templates/js/lib/datamap/datamaps.world.min.js"></script>
    <script src="/templates/js/lib/datamap/datamap-init.js"></script>

    <script src="/templates/js/lib/weather/jquery.simpleWeather.min.js"></script>
    <script src="/templates/js/lib/weather/weather-init.js"></script>
    <script src="/templates/js/lib/owl-carousel/owl.carousel.min.js"></script>
    <script src="/templates/js/lib/owl-carousel/owl.carousel-init.js"></script>

    <script src="/templates/js/lib/chartist/chartist.min.js"></script>
    <script src="/templates/js/lib/chartist/chartist-plugin-tooltip.min.js"></script>
    <script src="/templates/js/lib/chartist/chartist-init.js"></script>
    <!--Custom JavaScript -->
    <script src="/templates/js/custom.min.js"></script>
    <script>
      function dut_server(event) {
            event.preventDefault();
            var spinnerOverlay = document.getElementById("spinner-overlay");
            var buttons = document.querySelectorAll("button");
    
            spinnerOverlay.style.display = "flex";
            buttons.forEach((button) => button.classList.add("disabled"));
            const data = { servo_1: document.getElementById('servo_1').value,
                           servo_2: document.getElementById('servo_2').value,
                           servo_3: document.getElementById('servo_3').value,
                           servo_4: document.getElementById('servo_4').value,
                           servo_5: document.getElementById('servo_5').value,
                           servo_6: document.getElementById('servo_6').value
            };

            fetch('/api/dut', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
            document.getElementById('received-servo_1').value = data.servo_dict.servo_1;
            document.getElementById('received-servo_2').value = data.servo_dict.servo_2;
            document.getElementById('received-servo_3').value = data.servo_dict.servo_3;
            document.getElementById('received-servo_4').value = data.servo_dict.servo_4;
            document.getElementById('received-servo_5').value = data.servo_dict.servo_5;
            document.getElementById('received-servo_6').value = data.servo_dict.servo_6;
            document.getElementById('received-temperature').value = data.temperature;
            document.getElementById('received-humidity').value = data.humidity;
            document.getElementById('received-ip_address').value = data.ip_address;
            document.getElementById('received-detect').value = data.detect;
            document.getElementById('received-set_servo').value = data.set_servo;                
            document.getElementById('received-time').value = data.receivedtime;
            logGenerate(data.logs);
            setTimeout(function () {
              spinnerOverlay.style.display = "none";
              buttons.forEach((button) => button.classList.remove("disabled"));
            }); 
        });
        }

        
        function arm_server(event) {
            event.preventDefault();
            var spinnerOverlay = document.getElementById("spinner-overlay");
        var buttons = document.querySelectorAll("button");

        spinnerOverlay.style.display = "flex";
        buttons.forEach((button) => button.classList.add("disabled"));
            const data = { servo_1: document.getElementById('arm_servo_1').value,
                           servo_2: document.getElementById('arm_servo_2').value,
                           servo_3: document.getElementById('arm_servo_3').value,
                           servo_4: document.getElementById('arm_servo_4').value,
                           servo_5: document.getElementById('arm_servo_5').value,
                           servo_6: document.getElementById('arm_servo_6').value
            };

            fetch('/api/arm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(received_data => {
            document.getElementById('received-arm_servo_1').value = received_data.servo_dict.servo_1;
            document.getElementById('received-arm_servo_2').value = received_data.servo_dict.servo_2;
            document.getElementById('received-arm_servo_3').value = received_data.servo_dict.servo_3;
            document.getElementById('received-arm_servo_4').value = received_data.servo_dict.servo_4;
            document.getElementById('received-arm_servo_5').value = received_data.servo_dict.servo_5;
            document.getElementById('received-arm_servo_6').value = received_data.servo_dict.servo_6;
            document.getElementById('received-arm_temperature').value = received_data.temperature;
            document.getElementById('received-arm_humidity').value = received_data.humidity;
            document.getElementById('received-arm_ip_address').value = received_data.ip_address;
            document.getElementById('received-arm_detect').value = received_data.detect;
            document.getElementById('received-arm_set_servo').value = received_data.set_servo;                
            document.getElementById('received-arm_time').value = received_data.receivedtime;
            logGenerate(received_data.logs);
            setTimeout(function () {

              spinnerOverlay.style.display = "none";
              buttons.forEach((button) => button.classList.remove("disabled"));
            });
        });
        }



        function sendData(event) {
            event.preventDefault();
            var spinnerOverlay = document.getElementById("spinner-overlay");
        var buttons = document.querySelectorAll("button");

        spinnerOverlay.style.display = "flex";
        buttons.forEach((button) => button.classList.add("disabled"));
            const data = { real_position: parseFloat(document.getElementById('real_position').value) };

            fetch('/api/step', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
            document.getElementById('received-real_position').value = data.real_position;
            document.getElementById('received-step_time').value = data.step_time;
            document.getElementById('received-step_ip').value = data.step_ip;
            logGenerate(data.logs);
            setTimeout(function () {
              spinnerOverlay.style.display = "none";
              buttons.forEach((button) => button.classList.remove("disabled"));
            }); 
        });
        }

        function sendButtonPress(buttonId) {
          var spinnerOverlay = document.getElementById("spinner-overlay");
        var buttons = document.querySelectorAll("button");

        spinnerOverlay.style.display = "flex";
        buttons.forEach((button) => button.classList.add("disabled"));
            fetch('/api/button', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ button_id: buttonId })
            })
            .then(response => response.json())
            .then(received_data => {
                document.getElementById('received-AN203_ON_OFF_test').value = received_data.AN203_ON_OFF_test;
                document.getElementById('received-unet_time').value = received_data.unet_time;
                document.getElementById('received-unet_ip').value = received_data.unet_ip;
                logGenerate(received_data.logs);
            });
            setTimeout(function () {
              spinnerOverlay.style.display = "none";
              buttons.forEach((button) => button.classList.remove("disabled"));
            }); 
        }
      
      

        var logEntries = [];

      function logGenerate(logs) {
        var logDiv = document.getElementById("log");
        var newLogEntry = document.createElement("p");
        var logText = logs['time'] + '   '+ logs['device'] +'   '+logs['command'] +'  '+logs['status'] + '  ' + logs['operator']  ;
        newLogEntry.textContent = logText;
        logDiv.appendChild(newLogEntry);
        logEntries.push(logs);
      }

        function downloadLog() {
        var worksheet = XLSX.utils.json_to_sheet(logEntries);
        var workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Log");

        XLSX.writeFile(workbook, "log.xlsx");
      }

      function clearLog() {
        var logDiv = document.getElementById("log");
        logDiv.innerHTML = "<p>時間  裝置  指令  狀態  操作者</p>";
        logEntries = [];
      }


      document.addEventListener('DOMContentLoaded', function() {
    var dropdownToggle = document.querySelector('.nav-link.dropdown-toggle');
    var dropdownMenu = document.querySelector('.dropdown-menu');
    var closePopupButton = document.getElementById('closePopup');

    // Show the dropdown menu when the button is clicked
    dropdownToggle.addEventListener('click', function() {
        dropdownMenu.classList.toggle('show');
    });

    // Close the dropdown menu when the "X" button is clicked
    closePopupButton.addEventListener('click', function() {
        dropdownMenu.classList.remove('show');
        // Simulate clicking the dropdown toggle button
        dropdownToggle.click();
    });
});


    </script>
  </body>
</html>
