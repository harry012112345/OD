<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Generator and Uploader</title>
</head>
<body>
    <h1>帳號:{{username}} 登入時間:{{formatted_time}} ip:{{local_ip}}</h1>
    <h1>操作面板</h1>
    <form id="generate-form">
        <label for="servo_1">Servo 1:</label>
        <input type="number" id="servo_1" name="servo_1"><br>
        <label for="servo_2">Servo 2:</label>
        <input type="number" id="servo_2" name="servo_2"><br>
        <label for="servo_3">Servo 3:</label>
        <input type="number" id="servo_3" name="servo_3"><br>
        <label for="servo_4">Servo 4:</label>
        <input type="number" id="servo_4" name="servo_4"><br>
        <label for="servo_5">Servo 5:</label>
        <input type="number" id="servo_5" name="servo_5"><br>
        <label for="servo_6">Servo 6:</label>
        <input type="number" id="servo_6" name="servo_6"><br>
        <button type="submit">送出</button>
    </form>

    <h1>狀態面板</h1>
    <form id="receive-form">
        <label for="received-servo_1">Servo 1:</label>
        <input type="text" id="received-servo_1" readonly><br>
        <label for="received-servo_2">Servo 2:</label>
        <input type="text" id="received-servo_2" readonly><br>
        <label for="received-servo_3">Servo 3:</label>
        <input type="text" id="received-servo_3" readonly><br>
        <label for="received-servo_4">Servo 4:</label>
        <input type="text" id="received-servo_4" readonly><br>
        <label for="received-servo_5">Servo 5:</label>
        <input type="text" id="received-servo_5" readonly><br>
        <label for="received-servo_6">Servo 6:</label>
        <input type="text" id="received-servo_6" readonly><br>

        <label for="received-temperature">temperature</label>
        <input type="text" id="received-temperature" readonly><br>
        <label for="received-humidity">humidity</label>
        <input type="text" id="received-humidity" readonly><br>
        <label for="received-ip_address">ip_address</label>
        <input type="text" id="received-ip_address" readonly><br>
        <label for="received-detect">detect</label>
        <input type="text" id="received-detect" readonly><br>
        <label for="received-set_servo">communication</label>
        <input type="text" id="received-set_servo" readonly><br>

        <label for="received-time">更新時間</label>
        <input type="text" id="received-time" readonly><br>
        
        
    </form>
    
    <h1>arm_機器手臂操作面板</h1>
    <form onsubmit="arm_server(event)">
        <label for="arm_servo_1">Servo 1:</label>
        <input type="number" id="arm_servo_1" name="arm_servo_1"><br>
        <label for="arm_servo_2">Servo 2:</label>
        <input type="number" id="arm_servo_2" name="arm_servo_2"><br>
        <label for="arm_servo_3">Servo 3:</label>
        <input type="number" id="arm_servo_3" name="arm_servo_3"><br>
        <label for="arm_servo_4">Servo 4:</label>
        <input type="number" id="arm_servo_4" name="arm_servo_4"><br>
        <label for="servo_5">Servo 5:</label>
        <input type="number" id="arm_servo_5" name="arm_servo_5"><br>
        <label for="arm_servo_6">Servo 6:</label>
        <input type="number" id="arm_servo_6" name="arm_servo_6"><br>
        <button type="submit">送出</button>
    </form>
    
    <h1>arm_機器手臂狀態面板</h1>
    <label for="received-arm_servo_1">Servo 1:</label>
    <input type="text" id="received-arm_servo_1" readonly><br>
    <label for="received-arm_servo_2">Servo 2:</label>
    <input type="text" id="received-arm_servo_2" readonly><br>
    <label for="received-arm_servo_3">Servo 3:</label>
    <input type="text" id="received-arm_servo_3" readonly><br>
    <label for="received-arm_servo_4">Servo 4:</label>
    <input type="text" id="received-arm_servo_4" readonly><br>
    <label for="received-arm_servo_5">Servo 5:</label>
    <input type="text" id="received-arm_servo_5" readonly><br>
    <label for="received-arm_servo_6">Servo 6:</label>
    <input type="text" id="received-arm_servo_6" readonly><br>

    <label for="received-arm_temperature">temperature</label>
    <input type="text" id="received-arm_temperature" readonly><br>
    <label for="received-arm_humidity">humidity</label>
    <input type="text" id="received-arm_humidity" readonly><br>
    <label for="received-arm_ip_address">ip_address</label>
    <input type="text" id="received-arm_ip_address" readonly><br>
    <label for="received-arm_detect">detect</label>
    <input type="text" id="received-arm_detect" readonly><br>
    <label for="received-arm_set_servo">communication</label>
    <input type="text" id="received-arm_set_servo" readonly><br>

    <label for="received-arm_time">更新時間</label>
    <input type="text" id="received-arm_time" readonly><br>


    <h1>step_馬達操作面板</h1>
    <form onsubmit="sendData(event)">
    <label for="real_position">移動至距離原點:</label>
    <input type="text" id="real_position" name="real_position">
    <button type="submit">送出</button>
    </form>
    
    <h1>step_馬達狀態面板</h1>
    <label for="received-real_position">距離原點:</label>
    <input type="number" id="received-real_position"><br>
    <label for="received-step_time">更新時間:</label>
    <input type="text" id="received-step_time"><br>
    <label for="received-step_ip">ip位置    :</label>
    <input type="text" id="received-step_ip"><br>

   

    <h1>unet_AN203操作面板</h1>
        <button onclick="sendButtonPress('bing-btn')">Binding</button>
        <button onclick="sendButtonPress('test-btn')">AN203_ON_OFF_test</button>
        <button onclick="sendButtonPress('on-btn')">AN203_ON</button>
        <button onclick="sendButtonPress('off-btn')">AN203_OFF</button>

    <h1>unet_AN203_狀態面板</h1>
        <label for="received-set_MC026_binding">AN203學碼:</label>
        <input type="text" id="received-set_MC026_binding" readonly><br>
        <label for="received-AN203_ON_OFF_test">AN203狀態:</label>
        <input type="text" id="received-AN203_ON_OFF_test" readonly>
        <label for="received-AN203_ON_OFF_test">(ON or OFF)</label><br>
        <label for="received-unet_time">更新時間:</label>
        <input type="text" id="received-unet_time" readonly><br>
        <label for="received-unet_ip">ip位置:</label>
        <input type="text" id="received-unet_ip" readonly><br>

        <title>操作日誌</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .button-container {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
        }
    </style>
<body>
    <table id="log-table">
        <thead>
            <tr>
                <th>時間</th>
                <th>設備</th>
                <th>指令</th>
                <th>狀態</th>
                <th>操作人員</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.time }}</td>
                <td>{{ log.device }}</td>
                <td>{{ log.command }}</td>
                <td>{{ log.status }}</td>
                <td>{{ log.operator }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="button-container">
        <button onclick="location.href='/download_log'">下載</button>
        <button onclick="location.href='/clear_log'">清除</button>
    </div>
</body>

    <script>

        document.getElementById('generate-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const servo_1 = document.getElementById('servo_1').value;
            const servo_2 = document.getElementById('servo_2').value;
            const servo_3 = document.getElementById('servo_3').value;
            const servo_4 = document.getElementById('servo_4').value;
            const servo_5 = document.getElementById('servo_5').value;
            const servo_6 = document.getElementById('servo_6').value;

            const data = {
                servo_1: servo_1,
                servo_2: servo_2,
                servo_3: servo_3,
                servo_4: servo_4,
                servo_5: servo_5,
                servo_6: servo_6
            };

            fetch('/api/receive', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(received_data => {
                document.getElementById('received-servo_1').value = received_data.servo_dict.servo_1;
                document.getElementById('received-servo_2').value = received_data.servo_dict.servo_2;
                document.getElementById('received-servo_3').value = received_data.servo_dict.servo_3;
                document.getElementById('received-servo_4').value = received_data.servo_dict.servo_4;
                document.getElementById('received-servo_5').value = received_data.servo_dict.servo_5;
                document.getElementById('received-servo_6').value = received_data.servo_dict.servo_6;
                document.getElementById('received-temperature').value = received_data.temperature;
                document.getElementById('received-humidity').value = received_data.humidity;
                document.getElementById('received-ip_address').value = received_data.ip_address;
                document.getElementById('received-detect').value = received_data.detect;
                document.getElementById('received-set_servo').value = received_data.set_servo;                
                document.getElementById('received-time').value = received_data.receivedtime;


                
            })
            .catch(error => console.error('Error:', error));
        });

        function sendButtonPress(buttonId) {
            fetch('/api/button', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ button_id: buttonId })
            })
            .then(response => response.json())
            .then(received_data => {
                console.log(received_data);
                document.getElementById('received-set_MC026_binding').value = received_data.set_MC026_binding;
                document.getElementById('received-AN203_ON_OFF_test').value = received_data.AN203_ON_OFF_test;
                document.getElementById('received-unet_time').value = received_data.unet_time;
                document.getElementById('received-unet_ip').value = received_data.unet_ip;
                // 你可以在這裡更新UI或進行其他操作
            });
        }


        function sendData(event) {
            event.preventDefault();
            const data = { real_position: parseFloat(document.getElementById('real_position').value) };

            fetch('/api/step', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
            console.log(data);
            document.getElementById('received-real_position').value = data.real_position;
            document.getElementById('received-step_time').value = data.step_time;
            document.getElementById('received-step_ip').value = data.step_ip;
        });
        }

        function arm_server(event) {
            event.preventDefault();
            const data = { servo_1: document.getElementById('arm_servo_1').value,
                           servo_2: document.getElementById('arm_servo_2').value,
                           servo_3: document.getElementById('arm_servo_3').value,
                           servo_4: document.getElementById('arm_servo_4').value,
                           servo_5: document.getElementById('arm_servo_5').value,
                           servo_6: document.getElementById('arm_servo_6').value
            };

            fetch('/api/arm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(received_data => {
            document.getElementById('received-arm_servo_1').value = received_data.servo_dict.servo_1;
            document.getElementById('received-arm_servo_2').value = received_data.servo_dict.servo_2;
            document.getElementById('received-arm_servo_3').value = received_data.servo_dict.servo_3;
            document.getElementById('received-arm_servo_4').value = received_data.servo_dict.servo_4;
            document.getElementById('received-arm_servo_5').value = received_data.servo_dict.servo_5;
            document.getElementById('received-arm_servo_6').value = received_data.servo_dict.servo_6;
            document.getElementById('received-arm_temperature').value = received_data.temperature;
            document.getElementById('received-arm_humidity').value = received_data.humidity;
            document.getElementById('received-arm_ip_address').value = received_data.ip_address;
            document.getElementById('received-arm_detect').value = received_data.detect;
            document.getElementById('received-arm_set_servo').value = received_data.set_servo;                
            document.getElementById('received-arm_time').value = received_data.receivedtime;
        });
        }

        function downloadLog() {
    fetch('/download_log', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
    .then(response => response.json())
    .then(logs => {
        const tbody = document.querySelector('#log-table tbody');
        logs.forEach(log => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${log.time}</td>
                <td>${log.device}</td>
                <td>${log.command}</td>
                <td>${log.status}</td>
                <td>${log.operator}</td>
            `;
            tbody.appendChild(row);
        });
    })
    .catch(error => console.error('Error downloading log:', error));
}

function clearLog() {
    // 实现清除日志的逻辑，可以根据需要进行相应的后端处理
    fetch('/clear_log', {
        method: 'POST'
    })
    .then(response => {
        // 清除成功的处理逻辑，例如重新加载页面或更新界面状态
    })
    .catch(error => console.error('Error clearing log:', error));
}

    </script>
</body>
</html>
