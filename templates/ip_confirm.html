<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check Connections</title>
    <script>
      async function checkConnections() {
        try {
          let response = await fetch("/check_connections");
          let data = await response.json();
          if (data.results.every((result) => result)) {
            document.getElementById("next-button").disabled = false;
            document.getElementById("status").textContent =
              "All servers are connected.";
          } else {
            document.getElementById("next-button").disabled = true;
            document.getElementById("status").textContent =
              "Some servers are not connected. Please check the IPs.";
          }
        } catch (error) {
          console.error("Error checking connections:", error);
          document.getElementById("status").textContent =
            "Error checking connections.";
        }
      }

      async function startChecking() {
        const checkInterval = 5000; // Check every 5 seconds
        let intervalId = setInterval(async () => {
          try {
            let response = await fetch("/check_connections");
            let data = await response.json();
            if (data.results.every((result) => result)) {
              clearInterval(intervalId);
              document.getElementById("status").textContent =
                "All servers are connected.";
              document.getElementById("next-button").disabled = false;
            } else {
              document.getElementById("status").textContent =
                "Some servers are not connected. Please check the IPs.";
            }
          } catch (error) {
            console.error("Error checking connections:", error);
            document.getElementById("status").textContent =
              "Error checking connections.";
          }
        }, checkInterval);
      }
    </script>
  </head>
  <body>
    <h1>Check Connections</h1>
    <p id="status">Press the button to start checking connections.</p>
    <button id="start-button" onclick="startChecking()">Start Checking</button>
    <button id="next-button" onclick="window.location.href='/welcome'" disabled>
      Go to Next Page
    </button>
  </body>
</html>
